<!DOCTYPE html>
<!-- saved from url=(0052)file:///C:/Users/Tomass/Desktop/App%20Unificada.html -->
<html lang="es"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>App de Impresiones 3D - Corregida</title>
  <script src="./App de Impresiones 3D - Corregida_files/chart.js.descarga"></script>
  <script src="./App de Impresiones 3D - Corregida_files/jspdf.umd.min.js.descarga"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      margin: 0; padding: 2rem; color: #333;
    }
    nav {
      display: flex;
      background-color: #343a40;
      margin: -2rem -2rem 2rem;
      border-radius: 8px;
      overflow: hidden;
    }
    nav button {
      flex: 1;
      padding: 1rem;
      font-size: 1.1rem;
      background: none;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    nav button.active, nav button:hover {
      background-color: #495057;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input[type="number"], input[type="text"], select {
      padding: 0.5rem;
      width: 100%;
      max-width: 300px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
      box-sizing: border-box;
      transition: border-color 0.3s;
    }
    input[type="number"]:focus, input[type="text"]:focus, select:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 5px #007bff;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.7rem 1.5rem;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
      border-radius: 5px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    #resultado, #resumenGastos {
      margin-top: 2rem;
      padding: 1rem;
      background: #ffffff;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 700px;
    }
    .pedido-item {
      background: #fff;
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .pedido-info {
      flex: 1 1 60%;
      font-size: 0.95rem;
    }
    .pedido-controls button {
      margin-left: 0.5rem;
      font-size: 1rem;
    }
    .graficos {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: space-around;
      max-width: 900px;
      margin-top: 2rem;
    }
    .graficos canvas {
      flex: 1 1 300px;
      max-width: 300px;
      height: 250px !important;
      cursor: pointer;
      transition: box-shadow 0.3s;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .graficos canvas:hover {
      box-shadow: 0 0 15px rgba(0,123,255,0.7);
    }

    /* Modal general */
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      z-index: 9999;
      overflow-y: auto;
      transition: opacity 0.3s ease;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      animation: modalIn 0.3s ease forwards;
    }
    @keyframes modalIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .modal-close {
      position: absolute;
      top: 10px; right: 10px;
      font-size: 1.5rem;
      font-weight: bold;
      color: #333;
      cursor: pointer;
      border: none;
      background: transparent;
      transition: color 0.3s;
    }
    .modal-close:hover {
      color: #007bff;
    }
    #modalDetalle .modal-content {
      max-width: 500px;
    }
    #modalGrafico .modal-content {
      max-width: 800px;
      max-height: 80vh;
    }
    #modalPedidos .modal-content {
      max-width: 700px;
    }
  </style>
</head>
<body>

<nav>
  <button id="tabCalc" class="active" onclick="mostrarTab(&#39;calc&#39;)">üñ®Ô∏è Calculadora</button>
  <button id="tabResumen" onclick="mostrarTab(&#39;resumen&#39;)" class="">üìã Resumen</button>
</nav>

<section id="calc" class="active" aria-label="Calculadora de precios">
  <h1>üñ®Ô∏è Calculadora de Precios - Impresiones 3D</h1>

  <label>üìõ Nombre del pedido:
    <input type="text" id="nombrePedido" placeholder="Ej: Caja personalizada" maxlength="50">
  </label>

  <label>üí∞ Costo promedio x Hora ($ARS):
    <input type="number" id="costoHora" value="1300" min="0">
  </label>
  <label>‚è±Ô∏è Tiempo de impresi√≥n (horas):
    <input type="number" id="tiempoHoras" value="0" step="0.1" min="0" oninput="actualizarMinutos()">
  </label>
  <label>üïí Tiempo de impresi√≥n (minutos):
    <input type="number" id="tiempoMinutos" value="0" readonly="">
  </label>
  <label>üéØ Costo de material x kg ($ARS):
    <input type="number" id="costoKg" value="15000" min="0">
  </label>
  <label>‚öñÔ∏è Gramos gastados:
    <input type="number" id="gramos" value="0" min="0">
  </label>
  <label>üìà Multiplicador de material (%):
    <input type="number" id="multiplicadorMaterial" value="20" min="0">
  </label>
  <label>üîß Desgaste ($ por minuto):
    <input type="number" id="desgaste" value="5" min="0">
  </label>
  <label>‚ú® Post-procesado (%):
    <input type="number" id="postProcesado" value="30" min="0">
    <input type="checkbox" id="usarPostProcesado" checked=""> Usar post-procesado
  </label>
  <label>‚ö° Gasto de luz (por kWh en $ARS):
    <input type="number" id="costoLuz" value="360" min="0">
  </label>

  <button onclick="calcular()">üßÆ Calcular</button>
  <button onclick="guardarPedido()">üíæ Guardar pedido</button>

  <div id="resultado" role="region" aria-live="polite">
      <h2>üíµ Precio Calculado</h2>
      <p><strong>Precio base:</strong> $3650.00</p>
      <p><strong>Precio con post-procesado:</strong> $4745.00</p>
    </div>
  <div id="resumenGastos" role="region" aria-live="polite">
      <h3>üìä Resumen de Gastos</h3>
      <p>Costo Mano de Obra: $2600.00</p>
      <p>Costo Material: $378.00</p>
      <p>Desgaste: $600.00</p>
      <p>Costo Luz: $72.00</p>
      <p>Post-Procesado: 30%</p>
    </div>
</section>

<section id="resumen" aria-label="Resumen de trabajos" class="">
  <h1>üìã Resumen de Trabajos</h1>
  <button style="margin-bottom:1rem" onclick="abrirModalPedidos()">Ver pedidos guardados</button>
  <div class="graficos" aria-label="Gr√°ficos de resumen">
    <canvas id="graficoFacturacion" role="img" aria-label="Gr√°fico de facturaci√≥n"></canvas>
    <canvas id="graficoEstados" role="img" aria-label="Gr√°fico de estados"></canvas>
    <canvas id="graficoDiario" role="img" aria-label="Gr√°fico de ganancias diarias"></canvas>
  </div>
</section>

<!-- Modal Pedidos -->
<div id="modalPedidos" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalPedidosTitle" tabindex="-1">
  <div class="modal-content">
    <button class="modal-close" id="modalPedidosCloseBtn" aria-label="Cerrar ventana de pedidos">√ó</button>
    <h2 id="modalPedidosTitle">üì¶ Pedidos Guardados</h2>
    <div id="listaResumen"></div>
  </div>
</div>

<!-- Modal Detalle Pedido -->
<div id="modalDetalle" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalDetalleTitle" tabindex="-1">
  <div class="modal-content">
    <button class="modal-close" id="modalDetalleCloseBtn" aria-label="Cerrar ventana de detalle">√ó</button>
    <h2 id="modalDetalleTitle">üìù Detalle del Pedido</h2>
    <div id="detalleContenido"></div>
    <button onclick="exportarPDF()">üìÑ Exportar a PDF</button>
  </div>
</div>

<!-- Modal Grafico Ampliado -->
<div id="modalGrafico" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalGraficoTitle" tabindex="-1">
  <div class="modal-content">
    <button class="modal-close" id="modalGraficoCloseBtn" aria-label="Cerrar ventana de gr√°fico">√ó</button>
    <h2 id="modalGraficoTitle">üìä Gr√°fico Ampliado</h2>
    <canvas id="graficoGrande" style="max-height:70vh;"></canvas>
  </div>
</div>

<script>
  // Variables globales de gr√°ficos y pedidos
  let pedidos = JSON.parse(localStorage.getItem("pedidos") || "[]");
  let graficoFacturacion, graficoEstados, graficoDiario, graficoGrandeInstancia;

  // Mostrar pesta√±a
  function mostrarTab(tabId) {
    document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');

    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    document.getElementById('tab' + tabId.charAt(0).toUpperCase() + tabId.slice(1)).classList.add('active');

    if (tabId === 'resumen') actualizarResumen();
  }

  // Actualizar minutos basado en horas
  function actualizarMinutos() {
    const horas = parseFloat(document.getElementById('tiempoHoras').value) || 0;
    document.getElementById('tiempoMinutos').value = Math.round(horas * 60);
  }

  // Calcular precios y mostrar resultados
  function calcular() {
    const costoHora = Number(document.getElementById('costoHora').value) || 0;
    const tiempoHoras = Number(document.getElementById('tiempoHoras').value) || 0;
    const tiempoMinutos = tiempoHoras * 60;
    const costoKg = Number(document.getElementById('costoKg').value) || 0;
    const gramos = Number(document.getElementById('gramos').value) || 0;
    const multiplicadorMaterial = Number(document.getElementById('multiplicadorMaterial').value) || 0;
    const desgaste = Number(document.getElementById('desgaste').value) || 0;
    const postProcesadoPct = Number(document.getElementById('postProcesado').value) || 0;
    const usarPostProcesado = document.getElementById('usarPostProcesado').checked;
    const costoLuz = Number(document.getElementById('costoLuz').value) || 0;

    const materialReal = gramos * (1 + multiplicadorMaterial / 100);
    const costoMaterial = (materialReal / 1000) * costoKg;
    const desgasteTotal = desgaste * tiempoMinutos;
    const kWhTotal = 0.1 * tiempoHoras;
    const costoLuzTotal = kWhTotal * costoLuz;
    const costoManoObra = costoHora * tiempoHoras;
    const precioBase = costoManoObra + costoMaterial + desgasteTotal + costoLuzTotal;
    const precioConPost = usarPostProcesado ? precioBase * (1 + postProcesadoPct / 100) : precioBase;

    document.getElementById('resultado').innerHTML = `
      <h2>üíµ Precio Calculado</h2>
      <p><strong>Precio base:</strong> $${precioBase.toFixed(2)}</p>
      <p><strong>Precio con post-procesado:</strong> $${precioConPost.toFixed(2)}</p>
    `;

    document.getElementById('resumenGastos').innerHTML = `
      <h3>üìä Resumen de Gastos</h3>
      <p>Costo Mano de Obra: $${costoManoObra.toFixed(2)}</p>
      <p>Costo Material: $${costoMaterial.toFixed(2)}</p>
      <p>Desgaste: $${desgasteTotal.toFixed(2)}</p>
      <p>Costo Luz: $${costoLuzTotal.toFixed(2)}</p>
      <p>Post-Procesado: ${usarPostProcesado ? postProcesadoPct + '%' : 'No aplicado'}</p>
    `;

    return {
      precioBase,
      precioConPost,
      costoManoObra,
      costoMaterial,
      desgasteTotal,
      costoLuzTotal,
      usarPostProcesado,
      postProcesadoPct
    };
  }

  // Guardar pedido con nombre v√°lido
  function guardarPedido() {
    const nombre = document.getElementById('nombrePedido').value.trim();
    if (!nombre) {
      alert("Por favor, ingresa un nombre para el pedido.");
      return;
    }
    const calc = calcular();
    if (calc.precioBase === 0) {
      alert("Primero realiza un c√°lculo v√°lido.");
      return;
    }

    const fecha = new Date();
    const pedido = {
      id: Date.now(),
      nombre,
      fecha: fecha.toISOString(),
      costoHora: Number(document.getElementById('costoHora').value),
      tiempoHoras: Number(document.getElementById('tiempoHoras').value),
      costoKg: Number(document.getElementById('costoKg').value),
      gramos: Number(document.getElementById('gramos').value),
      multiplicadorMaterial: Number(document.getElementById('multiplicadorMaterial').value),
      desgaste: Number(document.getElementById('desgaste').value),
      postProcesadoPct: Number(document.getElementById('postProcesado').value),
      usarPostProcesado: document.getElementById('usarPostProcesado').checked,
      costoLuz: Number(document.getElementById('costoLuz').value),
      precioBase: calc.precioBase,
      precioConPost: calc.precioConPost,
      estado: "En Proceso"
    };
    pedidos.push(pedido);
    localStorage.setItem("pedidos", JSON.stringify(pedidos));
    alert("Pedido guardado con √©xito.");
    document.getElementById('nombrePedido').value = '';
  }

  // Abrir modal pedidos guardados
  function abrirModalPedidos() {
    actualizarListaPedidos();
    abrirModal('modalPedidos');
  }

  // Actualizar lista de pedidos en modal
  function actualizarListaPedidos() {
    const lista = document.getElementById('listaResumen');
    lista.innerHTML = '';
    if (pedidos.length === 0) {
      lista.innerHTML = "<p>No hay pedidos guardados.</p>";
      return;
    }
    pedidos.forEach(p => {
      const div = document.createElement('div');
      div.classList.add('pedido-item');

      const fecha = new Date(p.fecha);
      const fechaStr = fecha.toLocaleDateString() + " " + fecha.toLocaleTimeString();

      div.innerHTML = `
  <div class="pedido-info">
    <strong>${p.nombre}</strong><br>
    <small>ID: ${p.id} | Fecha: ${fechaStr}</small><br>
    <strong>Precio:</strong> $${(p.usarPostProcesado ? p.precioConPost : p.precioBase).toFixed(2)}
    <br><label>üìå Estado:
      <select onchange="cambiarEstadoPedido(${p.id}, this.value)">
        <option value="Terminado" ${p.estado === 'Terminado' ? 'selected' : ''}>Terminado</option>
        <option value="En Proceso" ${p.estado === 'En Proceso' ? 'selected' : ''}>En Proceso</option>
        <option value="Post Procesado" ${p.estado === 'Post Procesado' ? 'selected' : ''}>Post Procesado</option>
        <option value="No Empezado" ${p.estado === 'No Empezado' ? 'selected' : ''}>No Empezado</option>
      </select>
    </label>
  </div>
  <div class="pedido-controls">
    <button aria-label="Ver detalle del pedido ${p.nombre}" class="btn-detalle" onclick="abrirDetalle(${p.id})">Detalle del pedido</button>
    <button aria-label="Eliminar pedido ${p.nombre}" onclick="borrarPedido(${p.id})">üóëÔ∏è Borrar</button>
  </div>
`;
      lista.appendChild(div);
    });
  }

  // Borrar pedido por id
  function borrarPedido(id) {
    if(confirm("¬øSeguro que quieres eliminar este pedido?")) {
      pedidos = pedidos.filter(p => p.id !== id);
      localStorage.setItem("pedidos", JSON.stringify(pedidos));
      actualizarListaPedidos();
      actualizarResumen();
    }
  }

  // Abrir detalle de pedido en modal
  function abrirDetalle(id) {
    const pedido = pedidos.find(p => p.id === id);
    if(!pedido) return;

    const fecha = new Date(pedido.fecha);
    const fechaStr = fecha.toLocaleDateString() + " " + fecha.toLocaleTimeString();

    let detalleHTML = `
      <p><strong>Nombre:</strong> ${pedido.nombre}</p>
      <p><strong>Fecha:</strong> ${fechaStr}</p>
      <p><strong>Costo hora:</strong> $${pedido.costoHora}</p>
      <p><strong>Tiempo de impresi√≥n (horas):</strong> ${pedido.tiempoHoras}</p>
      <p><strong>Costo material por kg:</strong> $${pedido.costoKg}</p>
      <p><strong>Gramos gastados:</strong> ${pedido.gramos}</p>
      <p><strong>Multiplicador de material (%):</strong> ${pedido.multiplicadorMaterial}</p>
      <p><strong>Desgaste ($/min):</strong> $${pedido.desgaste}</p>
      <p><strong>Post-procesado (%):</strong> ${pedido.postProcesadoPct}</p>
      <p><strong>Usar post-procesado:</strong> ${pedido.usarPostProcesado ? 'S√≠' : 'No'}</p>
      <p><strong>Costo de luz (por kWh):</strong> $${pedido.costoLuz}</p>
      <hr />
      <p><strong>Precio base:</strong> $${pedido.precioBase.toFixed(2)}</p>
      <p><strong>Precio con post-procesado:</strong> $${pedido.precioConPost.toFixed(2)}</p>
    `;

    document.getElementById('detalleContenido').innerHTML = detalleHTML;
    abrirModal('modalDetalle');

    // Guardar el pedido actual para exportar PDF
    window.pedidoParaPDF = pedido;
  }

  // Exportar detalle a PDF
  async function exportarPDF() {
    if (!window.pedidoParaPDF) return alert("No hay pedido cargado para exportar.");

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const p = window.pedidoParaPDF;
    const fecha = new Date(p.fecha);
    const fechaStr = fecha.toLocaleDateString() + " " + fecha.toLocaleTimeString();

    doc.setFontSize(18);
    doc.text("Detalle de Pedido", 14, 20);
    doc.setFontSize(12);
    doc.text(`Nombre: ${p.nombre}`, 14, 30);
    doc.text(`Fecha: ${fechaStr}`, 14, 38);
    doc.text(`Costo hora: $${p.costoHora}`, 14, 46);
    doc.text(`Tiempo impresi√≥n (horas): ${p.tiempoHoras}`, 14, 54);
    doc.text(`Costo material x kg: $${p.costoKg}`, 14, 62);
    doc.text(`Gramos gastados: ${p.gramos}`, 14, 70);
    doc.text(`Multiplicador material (%): ${p.multiplicadorMaterial}`, 14, 78);
    doc.text(`Desgaste ($/min): $${p.desgaste}`, 14, 86);
    doc.text(`Post-procesado (%): ${p.postProcesadoPct}`, 14, 94);
    doc.text(`Usar post-procesado: ${p.usarPostProcesado ? 'S√≠' : 'No'}`, 14, 102);
    doc.text(`Costo luz (por kWh): $${p.costoLuz}`, 14, 110);
    doc.text(`Precio base: $${p.precioBase.toFixed(2)}`, 14, 120);
    const finalPrice = p.usarPostProcesado ? p.precioConPost : p.precioBase;
    doc.text(`Precio final: $${finalPrice.toFixed(2)}`, 14, 128);

    doc.save(`pedido_${p.nombre.replace(/\s+/g,'_')}_${p.id}.pdf`);
  }

  // Abrir modal
  function abrirModal(id) {
    const modal = document.getElementById(id);
    if (!modal) return;
    modal.classList.add('active');
    modal.focus();
  }
  // Cerrar modal
  function cerrarModal(id) {
    const modal = document.getElementById(id);
    if (!modal) return;
    modal.classList.remove('active');
  }

  // Eventos cerrar modales (botones)
  document.getElementById('modalPedidosCloseBtn').addEventListener('click', () => cerrarModal('modalPedidos'));
  document.getElementById('modalDetalleCloseBtn').addEventListener('click', () => cerrarModal('modalDetalle'));
  document.getElementById('modalGraficoCloseBtn').addEventListener('click', () => cerrarModal('modalGrafico'));

  // Cerrar modal con ESC
  document.addEventListener('keydown', e => {
    if (e.key === "Escape") {
      ['modalPedidos','modalDetalle','modalGrafico'].forEach(id => cerrarModal(id));
    }
  });

  // Actualizar resumen (lista y gr√°ficos)
  function actualizarResumen() {
    actualizarListaPedidos();
    actualizarGraficos();
  }

  // Actualizar gr√°ficos con Chart.js
  function actualizarGraficos() {
    // Datos para facturaci√≥n
    const facturacionData = {};
    const estadosData = { 'Terminado': 0, 'En Proceso': 0, 'Post Procesado': 0, 'No Empezado': 0 };

    // Para gr√°fico diario, acumulado por d√≠a (fecha YYYY-MM-DD)
    const gananciasPorDia = {};

    // Como en esta versi√≥n el estado no est√° editable, vamos a usar 'En Proceso' como estado default.
    pedidos.forEach(p => {
      const nombre = p.nombre;
      const total = p.usarPostProcesado ? p.precioConPost : p.precioBase;
      facturacionData[nombre] = (facturacionData[nombre] || 0) + total;

      // Estado para demo (puedes agregar estado editable si quieres)
      // Aqu√≠ asignamos "En Proceso" y "Post Procesado" basado en postProcesado
     if (estadosData[p.estado] !== undefined) {
  estadosData[p.estado]++;
    }
      // Fecha
      const dia = p.fecha.substring(0, 10);
      gananciasPorDia[dia] = (gananciasPorDia[dia] || 0) + total;
    });

    // Eliminar estados sin valor para limpiar gr√°ficos
    for (const key in estadosData) {
      if (estadosData[key] === 0) delete estadosData[key];
    }

    // Preparar contextos
    const ctxFact = document.getElementById('graficoFacturacion').getContext('2d');
    const ctxEstado = document.getElementById('graficoEstados').getContext('2d');
    const ctxDiario = document.getElementById('graficoDiario').getContext('2d');

    // Destruir si ya existen
    if (graficoFacturacion) graficoFacturacion.destroy();
    if (graficoEstados) graficoEstados.destroy();
    if (graficoDiario) graficoDiario.destroy();

    // Facturaci√≥n (barras)
    graficoFacturacion = new Chart(ctxFact, {
      type: 'bar',
      data: {
        labels: Object.keys(facturacionData),
        datasets: [{
          label: 'Total Facturado ($)',
          data: Object.values(facturacionData),
          backgroundColor: '#4CAF50',
          borderRadius: 4,
          maxBarThickness: 40
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          title: { display: true, text: 'Total por Pedido' }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: { precision: 0 }
          }
        }
      }
    });

    // Estados (pie)
    const coloresEstados = {
      "Terminado": "#4CAF50",
      "En Proceso": "#FFC107",
      "Post Procesado": "#2196F3",
      "No Empezado": "#F44336"
    };
    graficoEstados = new Chart(ctxEstado, {
      type: 'pie',
      data: {
        labels: Object.keys(estadosData),
        datasets: [{
          data: Object.values(estadosData),
          backgroundColor: Object.keys(estadosData).map(k => coloresEstados[k] || '#ccc')
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: { display: true, text: 'Estado de Pedidos' },
          legend: { position: 'bottom' }
        }
      }
    });

    // Ganancias diarias (line)
    // Ordenar fechas
    const diasOrdenados = Object.keys(gananciasPorDia).sort();
    const gananciasOrdenadas = diasOrdenados.map(d => gananciasPorDia[d]);
    graficoDiario = new Chart(ctxDiario, {
      type: 'line',
      data: {
        labels: diasOrdenados,
        datasets: [{
          label: 'Ganancias Diarias ($)',
          data: gananciasOrdenadas,
          borderColor: '#007bff',
          backgroundColor: 'rgba(0,123,255,0.3)',
          fill: true,
          tension: 0.3,
          pointRadius: 4
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: { display: true, text: 'Ganancias por D√≠a' },
          legend: { display: false }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // A√±adir evento click para ampliar gr√°ficos
    ['graficoFacturacion', 'graficoEstados', 'graficoDiario'].forEach(id => {
      const canvas = document.getElementById(id);
      canvas.onclick = () => ampliarGrafico(id);
    });
  }

  // Ampliar gr√°fico en modal
  function ampliarGrafico(idGrafico) {
    const modal = document.getElementById('modalGrafico');
    const ctxGrande = document.getElementById('graficoGrande').getContext('2d');

    // Destruir gr√°fico grande previo si existe
    if (graficoGrandeInstancia) graficoGrandeInstancia.destroy();

    // Copiar configuraci√≥n desde gr√°fico peque√±o
    let chartOriginal;
    switch(idGrafico) {
      case 'graficoFacturacion': chartOriginal = graficoFacturacion; break;
      case 'graficoEstados': chartOriginal = graficoEstados; break;
      case 'graficoDiario': chartOriginal = graficoDiario; break;
      default: chartOriginal = null;
    }
    if (!chartOriginal) return;

    // Clonar configuraci√≥n para gr√°fico grande
    const config = JSON.parse(JSON.stringify(chartOriginal.config));

    // Cambiar tama√±o para gr√°fico grande
    config.options.plugins.title.text += " (Ampliado)";
    config.options.plugins.legend.position = 'top';

    graficoGrandeInstancia = new Chart(ctxGrande, config);

    abrirModal('modalGrafico');
  }

  
function cambiarEstadoPedido(id, nuevoEstado) {
  const index = pedidos.findIndex(p => p.id === id);
  if (index !== -1) {
    pedidos[index].estado = nuevoEstado;
    localStorage.setItem("pedidos", JSON.stringify(pedidos));
    actualizarResumen();
  }
}

  // Inicializaci√≥n
  actualizarMinutos();
  actualizarResumen();

</script>




</body></html>